<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#151515">
<link rel="stylesheet" href="./style.css">
<title>TI-RADS Impressionizer</title>
<meta name="author" content="Felix Jin">
<meta name="description" content="A tool to generate impressions from TI-RADS findings.">
<meta name="keywords" content="TI-RADS, findings, impression, converter">
<link rel="canonical" href="https://fqjin.github.io/tirads/">

<!-- Setup Google Analytics -->


<script>
function parseText() {
	const inputText = document.getElementById("findings").value;
	const idxStart = inputText.search(/Nodule\s*\d:/);
	const idxEnd = inputText.search(/Lymph Nodes:/);
	if (idxStart == -1) {
		document.getElementById("impression").innerText = "No nodules detected.";
		return
	}
	const trimmedText = (idxEnd == -1) ?
		inputText.substring(idxStart) : 
		inputText.substring(idxStart, idxEnd);
		
	const dataArray = trimmedText.split(/Nodule\s*(\d):/).slice(1);
	if (dataArray.length % 2 !== 0) {
		document.getElementById("impression").innerText = "Something went wrong.";
		return
	}
	
	const regexSize = /Size:\s*([\d.]+)\s*x\s*([\d.]+)\s*x\s*([\d.]+)\s*cm/;
	const regexLoc = /Location:\s*(.+)(\bthyroid\b|\bisthmus\b)/;
	const regexTIRADS = /ACR TI-RADS category: TR(\d)/;
	const regexBiopsy = /Prior biopsy:\s*(.+)\n/;
	
	let results = [];
	results.push("TIRADS assessment of thyroid nodules:");
	for (let i = 0; i < dataArray.length; i += 2) {
		const noduleNumber = dataArray[i];
		const noduleData = dataArray[i+1] + "\n";
		
		let size = "unknown";
		let loc = "unknown";
		let tirads = " unknown";
		let biopsy;
		let rec;
		
		match = regexSize.exec(noduleData);
		if (match) {
			size = match.slice(1).sort((a, b) => Number(a) - Number(b)).slice(-1);
		}
		match = regexLoc.exec(noduleData);
		if (match) {
			loc = match.slice(1).join("");
		}
		match = regexTIRADS.exec(noduleData);
		if (match) {
			tirads = match[1];
		}
		match = regexBiopsy.exec(noduleData);
		if (match) {
			biopsy = match[1];
			if (biopsy.slice(0,2) == "no") {
				rec = getRecommendation(size, tirads);
			} else if (biopsy.slice(0,3) == "yes") {
				rec = `previously biopsied ${biopsy.slice(4)}. Follow up as clinically indicated`;
			} else {
				rec = `previously biopsied ${biopsy}. Follow up as clinically indicated`;
			}
		}
		results.push(`Nodule ${noduleNumber}, ${loc}: ACR TI-RADS TR${tirads}. Size: ${size} cm. Recommend: ${rec}.\n`);
	}

	results = results.join("\n");
	document.getElementById("impression").innerText = results;
}

function getRecommendation(size, tirads) {
	return "placeholder"
}
</script>

</head>

<body>
<div class="container">

<header>
	<div id="logo">
	<img src="https://edge.sitecorecloud.io/americancoldf5f-acrorgf92a-productioncb02-3650/media/ACR/Images/Logos/1x1/RADS/ACR-TI-RADS.png" alt="Thyroid logo" width=100px height=100px>
	</div>
	<a id="a-title" href="https://fqjin.github.io/tirads/">
	<h1>TI-RADS Impressionizer</h1>
	</a>
	<h2>A tool to generate impressions from TI-RADS findings.</h2>
</header>

<section id="main_content">
    <p>Paste findings below:</p>
	<textarea id="findings" placeholder="TI-RADS findings" rows=15 cols=64></textarea>
	<br>
	<button type="button" class="btn" onclick=parseText()>Convert</button>
	<p>Generated impression:</p>
	<div id="impression"></div>
	<br>
	<br>
</section>

<footer>
    <p>
	The information provided on this site is intended for educational and informational purposes only and does not constitute providing medical advice or professional services.
    No material on this site is intended to be a substitute for professional medical advice, diagnosis or treatment.
	For questions or comments, please contact Felix Jin. 
	<a href="https://github.com/fqjin/tirads">Source</a>
    </p>
</footer>

</div>
</body>

</html>